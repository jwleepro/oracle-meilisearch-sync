# Phase 01: Oracle-Meilisearch 동기화 시스템 개발 계획

## 개요

이 계획은 TDD(Test-Driven Development) 방식으로 Oracle-Meilisearch 동기화 시스템의 Phase 01을 구현합니다.
각 테스트는 순서대로 구현되며, 테스트가 통과한 후에만 다음 단계로 진행합니다.

**기술 스택**: Python (python-oracledb, FastAPI, Jinja2)

---

## 1. 프로젝트 설정

### 1.1 개발 환경 구성

- [ ] **TEST: 프로젝트 구조가 올바르게 생성됨**
  - src/, tests/ 디렉토리 생성
  - pyproject.toml 또는 requirements.txt 설정
  - pytest 설정 확인

---

## 2. Oracle DB 연결 (FR-101 준비)

### 2.1 DB 연결 설정

- [ ] **TEST: Oracle DB 연결 설정을 로드할 수 있음**
  - 환경 변수 또는 설정 파일에서 연결 정보 로드
  - 연결 정보 누락 시 적절한 예외 발생

- [ ] **TEST: Oracle DB에 연결할 수 있음**
  - python-oracledb를 사용한 연결 테스트
  - 연결 실패 시 적절한 예외 처리

- [ ] **TEST: Oracle DB 연결을 안전하게 종료할 수 있음**
  - 컨텍스트 매니저 패턴 사용
  - 리소스 누수 방지

---

## 3. Meilisearch 연결

### 3.1 Meilisearch 클라이언트 설정

- [ ] **TEST: Meilisearch 연결 설정을 로드할 수 있음**
  - 호스트, API 키 등 설정 로드
  - 설정 누락 시 적절한 예외 발생

- [ ] **TEST: Meilisearch에 연결할 수 있음**
  - 헬스 체크 엔드포인트 확인
  - 연결 실패 시 적절한 예외 처리

- [ ] **TEST: Meilisearch 인덱스를 생성할 수 있음**
  - 인덱스가 없으면 생성
  - 이미 존재하면 기존 인덱스 사용

---

## 4. 데이터 모델링

### 4.1 CRASIVTTST 테이블 매핑

- [ ] **TEST: Oracle 테이블 스키마를 조회할 수 있음**
  - CRASIVTTST 테이블의 컬럼 정보 조회
  - 데이터 타입 매핑

- [ ] **TEST: Oracle 레코드를 Meilisearch 문서로 변환할 수 있음**
  - 필드 매핑 정의
  - Primary Key 설정
  - 데이터 타입 변환 (날짜, 숫자 등)

---

## 5. 전체 동기화 (FR-101: Full Sync)

### 5.1 데이터 조회

- [ ] **TEST: Oracle에서 배치 단위로 데이터를 조회할 수 있음**
  - 배치 크기 설정 (기본: 1000건)
  - 커서 기반 페이지네이션
  - 메모리 효율적인 조회

- [ ] **TEST: 빈 테이블 조회 시 빈 결과를 반환함**
  - 예외 발생하지 않음
  - 빈 리스트 반환

### 5.2 데이터 저장

- [ ] **TEST: Meilisearch에 단일 문서를 저장할 수 있음**
  - 문서 추가 확인
  - 저장 후 조회 가능

- [ ] **TEST: Meilisearch에 배치로 문서를 저장할 수 있음**
  - 다수의 문서 일괄 저장
  - 저장 결과 확인

### 5.3 전체 동기화 프로세스

- [ ] **TEST: 전체 동기화를 실행할 수 있음**
  - Oracle에서 전체 데이터 조회
  - Meilisearch에 저장
  - 동기화 완료 확인

- [ ] **TEST: 전체 동기화 시 기존 인덱스를 초기화할 수 있음**
  - 옵션으로 기존 데이터 삭제
  - 새 데이터로 교체

---

## 6. 증분 동기화 (FR-102: Incremental Sync)

### 6.1 변경 감지

- [ ] **TEST: 마지막 동기화 시점을 저장/조회할 수 있음**
  - 동기화 시점 기록
  - 재시작 시 마지막 시점부터 진행

- [ ] **TEST: 특정 시점 이후 변경된 레코드를 조회할 수 있음**
  - 수정 일시(MODIFIED_DATE) 기준 필터링
  - 신규/수정 레코드 조회

### 6.2 증분 동기화 프로세스

- [ ] **TEST: 증분 동기화를 실행할 수 있음**
  - 변경된 데이터만 조회
  - Meilisearch 업데이트
  - 동기화 시점 갱신

- [ ] **TEST: 삭제된 레코드를 감지하고 동기화할 수 있음**
  - 소프트 삭제 또는 삭제 로그 기반 감지
  - Meilisearch에서 문서 삭제

---

## 7. 오류 처리 및 재시도 (FR-103)

### 7.1 재시도 메커니즘

- [ ] **TEST: 일시적인 오류 발생 시 자동 재시도함**
  - 네트워크 오류 등 일시적 오류
  - 지수 백오프 적용
  - 최대 재시도 횟수 설정

- [ ] **TEST: 영구적인 오류 발생 시 적절히 실패 처리함**
  - 재시도 횟수 초과 시
  - 실패 레코드 기록

### 7.2 부분 실패 처리

- [ ] **TEST: 배치 중 일부 실패 시 나머지는 계속 진행함**
  - 실패한 레코드 기록
  - 성공한 레코드는 저장

---

## 8. 모니터링 및 로깅 (FR-104)

### 8.1 동기화 상태 추적

- [ ] **TEST: 동기화 진행 상태를 조회할 수 있음**
  - 처리된 레코드 수
  - 남은 레코드 수 (전체 동기화 시)
  - 예상 완료 시간

- [ ] **TEST: 동기화 히스토리를 조회할 수 있음**
  - 동기화 시작/종료 시간
  - 성공/실패 건수
  - 오류 메시지

### 8.2 로깅

- [ ] **TEST: 동기화 이벤트가 적절히 로깅됨**
  - 시작/종료 로그
  - 오류 로그
  - 성능 메트릭 로그

---

## 9. 스케줄러 (FR-302 선행 구현)

### 9.1 자동 실행

- [ ] **TEST: 주기적으로 증분 동기화를 실행할 수 있음**
  - 설정 가능한 주기 (기본: 5분)
  - 중복 실행 방지

- [ ] **TEST: 스케줄러 시작/중지가 가능함**
  - 그레이스풀 셧다운
  - 실행 중인 동기화 완료 대기

---

## 10. CLI 인터페이스

### 10.1 명령어

- [ ] **TEST: CLI로 전체 동기화를 실행할 수 있음**
  - `python -m sync full` 명령
  - 진행 상황 출력

- [ ] **TEST: CLI로 증분 동기화를 실행할 수 있음**
  - `python -m sync incremental` 명령
  - 결과 요약 출력

- [ ] **TEST: CLI로 동기화 상태를 조회할 수 있음**
  - `python -m sync status` 명령
  - 현재 상태 및 히스토리 출력

---

## 비기능 요구사항 체크리스트

### 성능 (NFR-101 ~ NFR-103)

- [ ] 동기화 지연 시간 < 5초 (증분 동기화)
- [ ] 배치 처리로 대용량 데이터 효율적 처리

### 안정성 (NFR-104 ~ NFR-106)

- [ ] 동기화 실패 시 자동 복구
- [ ] 장애 발생 시 마지막 성공 시점부터 재개

### 확장성 (NFR-107 ~ NFR-108)

- [ ] 신규 테이블 추가 용이한 구조
- [ ] 설정 기반 필드 매핑

---

## 진행 규칙

1. 각 테스트는 **위에서 아래로 순서대로** 진행
2. **[ ]** 를 **[x]** 로 변경하여 완료 표시
3. 테스트가 통과하기 전에는 다음 테스트로 진행하지 않음
4. 리팩토링은 모든 테스트가 통과한 후에만 진행
5. 커밋은 구조적 변경과 동작적 변경을 분리

---

## 참고 문서

- [PRD](docs/Phase%2001/prd.md)
- [CLAUDE.md](CLAUDE.md) - TDD 및 개발 원칙
