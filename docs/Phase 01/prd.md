# PRD: Oracle-Meilisearch 동기화 시스템

## 1. 개요

### 1.1 배경
현재 시스템은 Oracle 11g를 주 데이터베이스로 사용하고 있습니다. 데이터 양이 증가함에 따라 다음과 같은 문제가 발생하고 있습니다:

- **대규모 조회 시 Oracle DB 과부하**: 복잡한 검색 쿼리 실행 시 DB 리소스 점유율 급증
- **전문 검색(Full-text Search) 성능 저하**: LIKE 연산자 기반 검색의 한계로 응답 속도 지연
- **복잡한 검색 조건 처리 어려움**: 다중 필드 검색, 오타 허용 검색 등 고급 검색 기능 부재

### 1.2 목표
Meilisearch를 검색 전용 엔진으로 도입하여 Oracle DB의 검색 부하를 분산하고, 빠르고 유연한 검색 경험을 제공합니다.

---

### 1.3 시스템 아키텍처

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   Application   │────▶│   Meilisearch    │◀────│   Sync Agent    │
│     (검색)      │     │   (검색 엔진)     │     │   (동기화)      │
└─────────────────┘     └──────────────────┘     └────────┬────────┘
                                                          │
                        ┌──────────────────┐              │
                        │   Oracle 11g     │◀─────────────┘
                        │   (원본 데이터)   │
                        └──────────────────┘
```

### 1.4 구성 요소

| 구성 요소 | 역할 |
|-----------|------|
| **Oracle 11g** | 원본 데이터 저장소 (SSOT: Single Source of Truth) |
| **Meilisearch** | 검색 전용 엔진 (읽기 최적화) |
| **Sync Agent** | Oracle → Meilisearch 데이터 동기화 담당 |
| **Application** | 검색 요청을 Meilisearch로 라우팅 |

---

## 2. 데이터 범위

### 2.1 동기화 대상 테이블

| 테이블명 | 설명 | 예상 레코드 수 |
|----------|------|----------------|
| **CRASIVTTST** | 주요 검색 대상 테이블 | 약 200만 건 |

### 2.2 데이터 규모

- **총 테이블 수**: 1개
- **총 레코드 수**: 약 2,000,000 건
- **예상 인덱스 크기**: TBD (스키마 분석 후 산정)

---

## 3. 기능 요구사항

### 3.1 Phase 01 데이터 동기화

| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-101 | 초기 전체 데이터 동기화(Full Sync) 지원 | P0 |
| FR-102 | 실시간/준실시간 동기화(Incremental Sync) 지원 | P0 |
| FR-103 | 동기화 실패 시 재시도 및 알림 기능 | P1 |
| FR-104 | 동기화 상태 모니터링 및 로깅 | P1 |

### 3.2 Phase 02 검색 기능

| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-201 | 전문 검색(Full-text Search) 지원 | P0 |
| FR-202 | 오타 허용 검색(Typo Tolerance) 지원 | P1 |
| FR-203 | 필터링 및 정렬 기능 | P0 |
| FR-204 | 페이지네이션 지원 | P0 |
| FR-205 | 하이라이팅(검색어 강조) 기능 | P2 |

### 3.3 Phase 03 관리 기능

| ID | 요구사항 | 우선순위 |
|----|----------|----------|
| FR-301 | 인덱스 설정 관리 (검색 가능 필드, 정렬 필드 등) | P1 |
| FR-302 | 동기화 스케줄 관리 | P1 |
| FR-303 | 수동 동기화 트리거 기능 | P2 |

---

## 4. 비기능 요구사항

### 4.1 성능

| ID | 요구사항 | 목표값 |
|----|----------|--------|
| NFR-101 | 검색 응답 시간 | < 50ms (95 percentile) |
| NFR-102 | 동기화 지연 시간 | < 5초|
| NFR-103 | 동시 검색 요청 처리 | 1,000 RPS 이상 |

### 4.2 안정성

| ID | 요구사항 | 목표값 |
|----|----------|--------|
| NFR-104 | 서비스 가용성 | 99.9% |
| NFR-105 | 데이터 정합성 | 99.99% (Oracle과 동기화) |
| NFR-106 | 장애 복구 시간 | < 30분 |

### 4.3 확장성

| ID | 요구사항 |
|----|----------|
| NFR-107 | 수평 확장 가능한 아키텍처 |
| NFR-108 | 신규 테이블/인덱스 추가 용이성 |

---

## 5. 기술 스택

| 영역 | 기술 |
|------|------|
|데이터 파이프라인 | Python (python-oracledb)|
|검색 엔진 | Meilisearch|
|웹 서버 | Python (FastAPI)|
|UI 렌더링 | Jinja2 Templates + Instant-meilisearch (JavaScript 라이브러리)|

---

## 6. 제약 사항

- Oracle 11g 버전 제약으로 인해 CDC(Change Data Capture) 기능 사용 불가
- Meilisearch는 쓰기 작업에 최적화되지 않음 → 검색 전용으로 사용
- 원본 데이터는 항상 Oracle에서 관리 (SSOT 원칙)

---

## 7. 성공 지표

- Oracle DB 검색 관련 쿼리 부하 **70% 이상 감소**
- 평균 검색 응답 시간 **90% 개선**
- 사용자 검색 만족도 향상 (전문 검색 기능 제공)

---

## 8. 리스크 및 대응 방안

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|-----------|
| 동기화 지연으로 인한 데이터 불일치 | 높음 | 상태 모니터링 및 자동 복구 메커니즘 |
| Meilisearch 장애 시 검색 불가 | 높음 | 폴백(Fallback)으로 Oracle 직접 검색 (자동 전환) |
| 대용량 초기 동기화 시 성능 저하 | 중간 | 배치 처리 및 비동기 처리 |
